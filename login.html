<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Login - Library Management System</title>
<!-- Bootstrap CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" xintegrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
<style>
    body {
        background-color: #f0f4ff;
        display: flex;
        align-items: center;
        justify-content: center;
        min-height: 100vh;
        font-family: 'Poppins', sans-serif;
    }
    .login-card {
        max-width: 450px;
        width: 100%;
    }
</style>
</head>
<body>

<div class="login-card p-3">
    <div class="card shadow-lg border-0 rounded-3">
        <div class="card-body p-4 p-sm-5">
            <h2 class="card-title text-center mb-4 fw-bold">Library Login</h2>
            <img src="user.jpeg" class="rounded-circle d-block mx-auto mb-3" alt="User Avatar">
            
            <!-- Simple place for messages -->
            <div id="message" class="text-center mb-3 fw-bold"></div>

            <!-- AUTH FORM (Sign up / Login) -->
            <div id="authArea">
                <form id="authForm">
                    <div class="form-floating mb-3">
                        <input type="email" class="form-control" id="email" placeholder="name@example.com" required>
                        <label for="email">Email address</label>
                    </div>
                    <div class="form-floating mb-3">
                        <input type="password" class="form-control" id="password" placeholder="Password" required>
                        <label for="password">Password</label>
                    </div>
                    
                    <div class="d-grid gap-2 mb-3">
                        <button id="loginBtn" type="button" class="btn btn-primary btn-lg">Login</button>
                        <button id="signupBtn" type="button" class="btn btn-outline-secondary">Sign Up</button>
                    </div>
                    
                    <div class="text-center">
                        <a href="#" id="resetLink" class="text-decoration-none">Forgot password?</a>
                    </div>
                </form>
            </div>
            
            <div class="text-center mt-4">
                 <!-- Changed link to point to index.html -->
                 <a href="index.html" class="text-decoration-none">&larr; Back to Home</a>
            </div>
        </div>
    </div>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

<script>
  // Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyDWsp-NJWXrNOIBJjCzo62MjJ2v105WStU",
    authDomain: "library-management-9169b.firebaseapp.com",
    projectId: "library-management-9169b",
    storageBucket: "library-management-9169b.firebasestorage.app",
    messagingSenderId: "984877351075",
    appId: "1:984877351075:web:4b4bc70849bec17106ff16"
  };
  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);

  // Firebase services
  const auth = firebase.auth();
  const db = firebase.firestore();

  // DOM refs
  const signupBtn = document.getElementById('signupBtn');
  const loginBtn = document.getElementById('loginBtn');
  const resetLink = document.getElementById('resetLink');

  // --- Utility Function ---
  const showMsg = (text, isError=false) => {
    const el = document.getElementById('message');
    el.className = isError ? 'text-danger' : 'text-success';
    el.textContent = text;
  };

  // --- Auth Management ---
  
  // AUTH STATE OBSERVER
  // On this page, redirect if the user is ALREADY logged in.
  auth.onAuthStateChanged(async (user) => {
    if (user) {
      showMsg('Already logged in. Redirecting...');
      // Redirect to the main app page as requested
      window.location.href = 'library management system.html';
    }
  });

  // SIGN UP
  signupBtn.addEventListener('click', async () => {
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;
    if (!email || !password) { 
      showMsg('Please enter email & password.', true); 
      return; 
    }
    if (password.length < 6) {
      showMsg('Password must be at least 6 characters.', true);
      return;
    }
    showMsg('Signing up...');
    try {
      const userCred = await auth.createUserWithEmailAndPassword(email, password);
      // Optionally save profile to Firestore
      const uid = userCred.user.uid;
      await db.collection('users').doc(uid).set({
        email,
        createdAt: firebase.firestore.FieldValue.serverTimestamp()
      });
      // onAuthStateChanged will catch this and redirect to library managemant system.html
    } catch (err) {
      showMsg(`Signup error: ${err.message}`, true);
    }
  });

  // LOGIN
  loginBtn.addEventListener('click', async () => {
    const email = document.getElementById('email').value.trim();
    const password = document.getElementById('password').value;
    if (!email || !password) { 
      showMsg('Please enter email & password.', true); 
      return; 
    }
    showMsg('Logging in...');
    try {
      await auth.signInWithEmailAndPassword(email, password);
      // onAuthStateChanged will catch this and redirect to library managemant system.html
    } catch (err) {
      showMsg('Login error: ' + err.message, true);
    }
  });

  // PASSWORD RESET
  resetLink.addEventListener('click', async (e) => {
    e.preventDefault();
    const email = document.getElementById('email').value.trim();
    if (!email) { 
      showMsg('Enter your email to reset password.', true); 
      return; 
    }
    showMsg('Sending reset email...');
    try {
      await auth.sendPasswordResetEmail(email);
      showMsg('Password reset email sent!');
    } catch (err) {
      showMsg('Reset error: ' + err.message, true);
    }
  });
</script>

</body>
</html>
